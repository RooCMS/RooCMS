RewriteEngine On
RewriteBase /api/

# Ensure directory access and directory index resolve correctly
Require all granted
DirectoryIndex index.php
Options -MultiViews

# Allow access to index.php
<Files "index.php">
    Require all granted
    Satisfy Any
</Files>

# CORS headers
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Methods "GET, POST, PUT, PATCH, DELETE, OPTIONS"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization"

# Handle preflight OPTIONS requests
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ index.php [L]

# Always route versioned API prefixes (e.g., /v1, /v1/...) to index.php
RewriteRule ^v[0-9]+(/.*)?$ index.php [L,QSA]

# Route non-existing paths to index.php (handles nested routes like /api/v1/name)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.php [L,QSA]